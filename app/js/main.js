"use strict";var GOOGLE_IP="http://169.254.119.203:8080/",ACCESS_TOKEN="a0bb5189-ba79-482e-ab62-3aabf055c250",app=angular.module("conneccityApp",["ngRoute","ngResource"]);app.config(["$routeProvider",function(e){e.when("/signin",{templateUrl:"views/sign.html",controller:"signInController"}).when("/signup",{templateUrl:"views/signup.html",controller:"signupController"}).when("/map",{templateUrl:"views/mappage.html",controller:"mapController"}).when("/map/users/:userId",{templateUrl:"views/user.html",controller:"userController"}).when("/map/events/:eventId",{templateUrl:"views/event.html",controller:"eventController"}).when("/map/meetings/:meetingId",{templateUrl:"views/meeting.html",controller:"meetingController"})}]),app.controller("meetingController",["$scope","$http","$routeParams",function(e,t,o){t.get(GOOGLE_IP+"/meetings/"+o.meetingId,{headers:{Authorization:"Bearer "+ACCESS_TOKEN}}).then(function(e){console.log(e)}),e.id=o.meetingId}]),app.controller("eventController",["$scope","$http","$routeParams",function(e,t,o){t.get(GOOGLE_IP+"/events/"+o.eventId,{headers:{Authorization:"Bearer "+ACCESS_TOKEN}}).then(function(e){console.log(e)}),e.id=o.eventId}]),app.controller("userController",["$scope","$http","$routeParams",function(e,t,o){t.get(GOOGLE_IP+"/users/"+o.userId,{headers:{Authorization:"Bearer "+ACCESS_TOKEN}}).then(function(e){console.log(e)}),e.id=o.userId}]),app.controller("mapController",["$scope","$http","$window",function(e,t,o){}]),app.directive("ngMap",function(){return{templateUrl:"views/map.html",controller:"mapCreateController"}}),app.factory("blendImage",function(e,t){var o=e,a=t,n=document.createElement("canvas"),r=n.getContext("2d"),l=o.width,i=o.height;n.width=l,n.height=i;var s=4*l*i;r.drawImage(o,0,0);var d=r.getImageData(0,0,l,i),p=d.data;r.drawImage(a,0,0);for(var c=r.getImageData(0,0,l,i),g=c.data;s--;)p[s]=.5*p[s]+.5*g[s];d.data=p,r.putImageData(d,0,0)}),app.controller("mapCreateController",["$scope","$http","$location",function(e,t,o){var a=new google.maps.Map(document.getElementById("map"),{center:{lat:0,lng:0},zoom:1}),n=[{url:"img/cluster.png",height:28,width:28}],r=new MarkerClusterer(a,[],{gridSize:50,zoomOnClick:!1,styles:n}),l=function(e,t){function o(){r&&n.drawImage(r,0,0,100,100),l&&n.drawImage(l,0,0,100,100)}var a=document.createElement("canvas"),n=a.getContext("2d"),r=new Image;r.src=e,r.onload=o;var l=new Image;return l.src=t,l.onload=o,console.log(a.toDataURL()),a.toDataURL()};e.data=[{latitude:45,longitude:45},{latitude:45,longitude:45},{latitude:44,longitude:45}];for(var i in e.data)if(e.data[i]){var s;!function(){console.log(e.data[i].latitude+" "+e.data[i].longitude),s=new google.maps.Marker({id:e.data[i].id,position:{lat:e.data[i].latitude,lng:e.data[i].longitude},optimized:!1,icon:{url:l("img/pin.png","img/cluster.png"),scaledSize:new google.maps.Size(20,16)},data:e.data[i]});var t=e.data[i];s.addListener("click",function(){e.$apply(function(){o.path(o.path()+(t.surname?"/users":t.member?"/meetings":"/events")+"/"+t.id)})}),r.addMarker(s)}()}google.maps.event.addListener(r,"clusterclick",function(e){console.log(e.getMarkers())})}]),app.controller("signupController",["$scope","$http",function(e,t){e.data={email:"1234@gmail.com",name:"kogut",surname:"andrey",dateBirthday:"1997-12-20",gender:1,password:"123456",passwordConfirm:"123456",mobilePhone:"+12345678"};var o={method:"POST",url:GOOGLE_IP+"/signup",data:e.data,headers:{"Content-Type":"application/json"}};t(o)}]),app.controller("signInController",["$scope","$http","$httpParamSerializer",function(e,t,o){e.data={grant_type:"password",scope:"",username:"google@mail.ru",password:"google228"},e.encoded=btoa("clientapp:123456");var a={method:"POST",url:GOOGLE_IP+"/oauth/token",data:o(e.data),headers:{Authorization:"Basic "+e.encoded,"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}};t(a).success(function(e){console.log("Google WP"),console.log(e)}).error(function(e,t){console.log(t)})}]);